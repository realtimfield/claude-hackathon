# Implementation Notes - Collaborative Jigsaw Puzzle MVP

## Overview
This document captures the specific implementation details and decisions made while building the MVP version of the collaborative jigsaw puzzle application.

## Technology Stack
- **Backend**: Spring Boot 2.7.14 with Java 11
- **Frontend**: React 18 with TypeScript, Redux Toolkit, and Vite
- **Database**: Redis (single data store for sessions and images)
- **Real-time Communication**: Native WebSocket API
- **Build Tools**: Maven with frontend-maven-plugin for integrated builds
- **Containerization**: Docker with multi-stage builds

## Key Implementation Details

### 1. Image Processing
- Uses Java's `ImageIO` and `BufferedImage` for image manipulation
- Puzzle pieces are generated by dividing the original image into a grid
- Each piece is stored as a separate image in Redis
- Grid sizes supported: 2x2, 3x3, 5x5, 8x8

### 2. Session Management
- Sessions are stored in Redis with configurable TTL (default: 3600 seconds)
- Session ID generation uses UUID
- All session data is serialized using Jackson with JSR310 module for Java time types

### 3. WebSocket Implementation
- WebSocket endpoint: `/ws/puzzle/{sessionId}`
- User ID can be passed as query parameter: `?userId={userId}`
- Messages use a typed format with `WebSocketMessage` class
- Supported message types:
  - PIECE_MOVE
  - PIECE_LOCK
  - PIECE_UNLOCK
  - CURSOR_MOVE
  - SESSION_STATE
  - USER_JOIN
  - USER_LEAVE
  - PUZZLE_COMPLETE

### 4. API Endpoints
- `POST /api/sessions` - Create new puzzle session (multipart form with image file and gridSize)
- `GET /api/sessions/{sessionId}` - Get session details
- `POST /api/sessions/{sessionId}/join` - Join a session
- `GET /api/images/{imageId}` - Retrieve stored images

### 5. Redis Configuration
- Uses `GenericJackson2JsonRedisSerializer` for value serialization
- Configured with JavaTimeModule for proper LocalDateTime handling
- Type information is stored with objects to enable polymorphic deserialization

### 6. Docker Setup
- Multi-stage build to minimize image size
- Frontend is built during Docker build process
- Static files are served from Spring Boot
- Redis runs as a separate container with health checks

### 7. Frontend Architecture
- Redux store manages:
  - Session state
  - Puzzle pieces
  - User information
  - WebSocket connection
- Canvas-based rendering for puzzle board
- Drag-and-drop implemented for piece movement
- Real-time cursor tracking for all users

## Known Limitations
1. No user authentication/authorization
2. No puzzle completion animation
3. No piece rotation feature
4. Limited to rectangular pieces (no jigsaw edges)
5. No persistence beyond Redis TTL

## Testing
- Unit tests for `PuzzleService` using Mockito
- Integration tests for API endpoints (requires Docker for testcontainers)
- WebSocket handler tests for message handling

## Deployment Notes
- Ensure Redis is accessible at configured host/port
- Set appropriate environment variables:
  - `REDIS_HOST` (default: localhost)
  - `REDIS_PORT` (default: 6379)
  - `SERVER_PORT` (default: 8080)
- Frontend build output is included in the JAR file

## Future Enhancements
1. Add authentication and user management
2. Implement proper jigsaw-shaped pieces with tabs and blanks
3. Add puzzle completion detection and celebration animation
4. Support piece rotation
5. Add puzzle templates and categories
6. Implement invite links for private sessions
7. Add sound effects and background music options
8. Create mobile-responsive UI